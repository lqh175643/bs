import{_ as E,o as c,c as u,b as a,t as d,n as U,u as j,g as T,j as x,P as O,C as z,i as F,r as p,f as D,A as _,h as R,e as v,d as g,F as y,B as k,H as A,Q as L,E as q,p as H,q as Q}from"./index-4fd5423a.js";import{g as G}from"./order-65a2f2b1.js";const J={name:"Coupon",props:{coupon:{type:Object,default:()=>{}},isActive:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!1}},setup(i){return{}}},K={class:"coupon_header"},W={class:"top"},X={class:"coupon_footer"};function Y(i,t,r,e,f,I){return c(),u("div",{class:U(["coupon_wrapper",r.isActive?"active":"",r.isDisabled?"disabled":""])},[a("div",K,[a("div",W,[a("strong",null,"￥"+d(r.coupon.reduce),1),a("span",null," 满"+d(r.coupon.price),1),a("div",null,"有效期至"+d(r.coupon.time||"2023-2-20"),1)])]),a("div",X,d(r.coupon.limit),1)],2)}const Z=E(J,[["render",Y]]);const $={name:"Shoping",components:{Coupon:Z},props:{buyData:{type:Object,default:()=>{}},dialogTableVisible:{type:Boolean,default:!1},propReceive:{type:Number,default:""}},emits:["shopClose","myrefresh"],setup(i,t){const r=Array.isArray(i.buyData)?i.buyData:[i.buyData],e=j(),f=T(),I=x(()=>i.dialogTableVisible),h=T("1"),C=e.getters.receivingAddress,b=O(e.getters.vip),N=C.map(n=>({value:n.addr_id,label:n.user+" "+z(n.receivingAddress)+" "+n.phoneNumber})),V=["微信","支付宝"],S=e.getters.consumerCoupon,B=x(()=>{let n=0;return r.forEach(l=>n+=Number(l.price)*l.count),n}),o=x(()=>{const n=s.consumerCoupon.reduce;let l=n||0,m=0;return r.forEach(M=>m+=Number(M.price)*M.count),m=m-s.campusBean/100-l,b&&(m=(m*.95).toFixed(2)),m}),s=F({receiveInfo:i.propReceive,payMethod:"微信",consumerCoupon:"",campusBean:0});return{dialogTableVisible:I,formData:s,receiveInfo:N,payMethods:V,dialogClose:()=>{t.emit("shopClose"),f.value=-1,s.campusBean=0,s.consumerCoupon=""},buyData:r,allPrice:o,consumerCoupons:S,activeName:h,store:e,goPay:()=>{if(!s.receiveInfo){A({message:"请填写收货人信息",type:"warning",offset:60});return}const n=L.service({lock:!0,text:"订单生成中",background:"rgba(0, 0, 0, 0.7)"});G({goods:r.map(l=>({jid:l.jid,count:l.count,des:l.des,price:l.price,img:l.img,category:l.category,isComment:!1})),generateTime:Date.now(),originalPrice:B.value,finalPrice:o.value,coupon:s.consumerCoupon,campusBean:s.campusBean,receiveInfo:s.receiveInfo,payMethod:s.payMethod,isPay:!0,isReceive:!1,is_vip:b}).then(()=>{setTimeout(()=>{n.close(),t.emit("shopClose"),A({message:"购买成功，查看请到我的订单",type:"success",offset:60})},1e3),q(e),t.emit("myrefresh")},l=>{console.log(l)})},handleCoupons:(n,l)=>{if(l<=B.value)switch(f.value=n,l){case 10:s.consumerCoupon={reduce:2};break;case 99:s.consumerCoupon={reduce:10};break}},active_coupons:f,is_vip:b,campusBeanOptions:[{value:100},{value:200},{value:500},{value:1e3}]}}},P=i=>(H("data-v-1cec930c"),i=i(),Q(),i),ee=P(()=>a("div",{class:"bold_text"},"收货人信息",-1)),oe={class:"shop_body_item"},ae=P(()=>a("div",{class:"bold_text"},"支付方式",-1)),se={class:"shop_body_item"},te=P(()=>a("div",{class:"bold_text"},"送货清单",-1)),le={class:"shop_body_item"},ne=["src"],ce={class:"good_des"},ie={class:"good_price"},re={class:"good_count"},de={class:"shop_body_item"},ue={class:"consumer_coupons"},_e=["onClick"],pe={class:"campusBean"},me=P(()=>a("br",null,null,-1)),ve={class:"footer_wrapper"},fe={key:0,class:"plus"},be={class:"allPrice"};function ge(i,t,r,e,f,I){const h=p("el-option"),C=p("el-select"),b=p("el-radio"),N=p("Coupon"),V=p("el-tab-pane"),S=p("el-tabs"),B=p("el-dialog");return c(),D(B,{modelValue:e.dialogTableVisible,"onUpdate:modelValue":t[5]||(t[5]=o=>e.dialogTableVisible=o),title:"结算页","custom-class":"dialog_wrapper","before-close":e.dialogClose,width:600,"destroy-on-close":!0},{footer:_(()=>[a("div",ve,[e.is_vip?(c(),u("span",fe,"Plus会员独享95折")):R("",!0),a("span",be,"总计:￥"+d(e.allPrice),1),a("span",{class:"payBtn",onClick:t[4]||(t[4]=(...o)=>e.goPay&&e.goPay(...o))},"去支付")])]),default:_(()=>[ee,a("div",oe,[v(C,{modelValue:e.formData.receiveInfo,"onUpdate:modelValue":t[0]||(t[0]=o=>e.formData.receiveInfo=o),placeholder:"Select",size:"large",style:{width:"300px"}},{default:_(()=>[(c(!0),u(y,null,g(e.receiveInfo,o=>(c(),D(h,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),ae,a("div",se,[(c(!0),u(y,null,g(e.payMethods,(o,s)=>(c(),D(b,{modelValue:e.formData.payMethod,"onUpdate:modelValue":t[1]||(t[1]=w=>e.formData.payMethod=w),key:s,label:o,size:"large",class:"pay_method"},{default:_(()=>[k(d(o),1)]),_:2},1032,["modelValue","label"]))),128))]),te,a("div",le,[(c(!0),u(y,null,g(e.buyData,(o,s)=>(c(),u("div",{class:"good_item",key:s},[a("img",{class:"good_img",src:o.img},null,8,ne),a("span",ce,d(o.des),1),a("i",ie,"￥"+d(o.price),1),a("span",re,"×"+d(o.count),1)]))),128))]),a("div",de,[v(S,{modelValue:e.activeName,"onUpdate:modelValue":t[3]||(t[3]=o=>e.activeName=o),class:"demo-tabs"},{default:_(()=>[v(V,{label:"优惠券",name:"1"},{default:_(()=>[a("div",ue,[(c(!0),u(y,null,g(e.consumerCoupons,(o,s)=>(c(),u("div",{class:"consumer_coupon",key:s,onClick:w=>e.handleCoupons(s,o.price)},[v(N,{coupon:o,class:"coupon","is-active":e.active_coupons===s,"is-disabled":e.allPrice<=o.price},null,8,["coupon","is-active","is-disabled"])],8,_e))),128))])]),_:1}),v(V,{label:"校园豆",name:"2"},{default:_(()=>[a("div",pe,[k(" 账户共 "+d(e.store.getters.campusBean)+" 校园豆",1),me,k("本次使用 "),v(C,{modelValue:e.formData.campusBean,"onUpdate:modelValue":t[2]||(t[2]=o=>e.formData.campusBean=o),placeholder:"Select",size:"small"},{default:_(()=>[(c(!0),u(y,null,g(e.campusBeanOptions,o=>(c(),D(h,{key:o.value,label:o.value,value:o.value,disabled:o.value>=e.store.getters.campusBean},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"]),k(" 抵扣￥"+d(e.formData.campusBean/100),1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue","before-close"])}const Be=E($,[["render",ge],["__scopeId","data-v-1cec930c"]]);export{Be as S};
