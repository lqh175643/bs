import{_ as q,u as z,a as H,g,k as L,r as h,o as f,c as v,e as i,A as u,b as a,B as S,t as B,f as O,h as E,F as R,H as D,j as G,E as I,d as J,p as Q,q as W}from"./index-0598f3a8.js";import{S as X}from"./Shoping-74d6af9d.js";import{a as Y,g as Z}from"./userHome-42eda77e.js";import"./order-9b975a2b.js";const $={name:"ShopBus",components:{Shoping:X},setup(m){const t=z(),x=H(),e=g();let w=g("0"),C=g("0.00"),r=g([]),b=g(!1),k=g(!1),y=g(""),V=[];const p=g([]),o=()=>{if(p.value.length<=0){D({message:"至少选择一种商品",type:"warning",offset:60});return}k.value=!0},_=l=>{V=l;let d=0,n=0,c=p.value.length;l.forEach(s=>{d+=s.count,n+=s.count*s.price}),w.value=d,C.value=n.toFixed(2),p.value.splice(0,c),l.forEach(s=>{p.value.push({jid:s.jid,img:s.goods.img,des:s.goods.des,price:s.price,count:G(()=>s.count),category:s.goods.category})})},T=l=>{e.value.toggleAllSelection()},A=l=>{l?l.forEach(d=>{e.value.toggleRowSelection(d,void 0)}):e.value.clearSelection()},N=l=>{let d=0,n=0;V.forEach(c=>{d+=c.count,n+=c.count*c.price}),w.value=d,C.value=n.toFixed(2)},U=()=>{D({message:"收藏成功",type:"success",offset:60})},F=l=>l.jid,M=()=>{Y({Ptarget:"shopBus",target:"jid",val:[y.value]}).then(async l=>{D({message:"删除成功",type:"success",offset:60}),await I(t),j(t.getters.shopBus)},l=>{D({message:"删除失败",type:"error",offset:60})}).finally(()=>{b.value=!1})},P=l=>{b.value=!0,y.value=l.jid},j=l=>{r.value=[];const d={ids:l.map(n=>n.jid)};Z(d).then(n=>{Array.isArray(n)&&n.length>0&&n.forEach((c,s)=>{r.value.push({goods:{img:c.imgUrl,des:c.detail,category:l[s].category},jid:c.id,price:c.price.split("￥")[1],count:1,operation:["delete"],curprice:0})})},n=>{console.log(n)})},K=l=>{x.push({path:`/detail/${l?.goods?.category}/${l.jid}`})};return L(()=>{j(t.getters.shopBus)}),{multipleTableRef:e,handleSelectionChange:_,toggleSelection:A,handtoggleAllSelection:T,handleNumChange:N,moveToCol:U,tableData:r,totleCount:w,totlePrice:C,getRowKeys:F,shopBusDelete:M,dialogVisible:b,btnDelete:P,buyBtn:o,buyData:p,dialogTableVisible:k,myrefresh:async()=>{e.value.clearSelection(),await I(t),j(t.getters.shopBus)},goodClick:K}}},ee=m=>(Q("data-v-4a761463"),m=m(),W(),m),oe=["onClick"],te=["src"],le={class:"count_wrapper"},ae={class:"operation_wrapper"},ne={class:"operation_wrapper"},se=["onClick"],ie={key:1},re={class:"bottom_bar"},ce={class:"totle_count"},de={class:"totle_price"},ue=ee(()=>a("span",null,"是否移除此商品",-1)),ge={class:"dialog-footer"};function pe(m,t,x,e,w,C){const r=h("el-table-column"),b=h("el-input-number"),k=h("el-table"),y=h("el-button"),V=h("el-dialog"),p=h("Shoping");return f(),v(R,null,[i(k,{ref:"multipleTableRef",data:e.tableData,"row-key":e.getRowKeys,onSelectAll:e.handleSelectionChange,onSelect:e.handleSelectionChange},{default:u(()=>[i(r,{type:"selection","reserve-selection":!0,"row-key":"jid",width:"55"}),i(r,{label:"商品",width:"450"},{default:u(o=>[a("div",{class:"goods_wrapper",onClick:_=>e.goodClick(o.row)},[a("img",{src:o.row.goods.img,alt:""},null,8,te),a("div",null,B(o.row.goods.des),1)],8,oe)]),_:1}),i(r,{prop:"price",label:"单价(元)",width:"120"}),i(r,{prop:"count",label:"数量",width:"150"},{default:u(o=>[a("div",le,[i(b,{modelValue:o.row.count,"onUpdate:modelValue":_=>o.row.count=_,min:1,max:100,size:"small",onChange:e.handleNumChange},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),i(r,{prop:"curprice",label:"小计(元)",width:"120"},{default:u(o=>[a("div",ae,B((o.row.count*o.row.price).toFixed(2)),1)]),_:1}),i(r,{prop:"operation",label:"操作"},{default:u(o=>[a("div",ne,[(f(!0),v(R,null,J(o.row.operation,(_,T)=>(f(),v("div",{key:T},[_=="delete"?(f(),v("div",{key:0,onClick:A=>e.btnDelete(o.row)}," 删除 ",8,se)):_=="check"?(f(),v("div",ie,"查看")):E("",!0)]))),128))])]),_:1})]),_:1},8,["data","row-key","onSelectAll","onSelect"]),a("div",re,[a("span",{class:"margin_right_10",onClick:t[0]||(t[0]=(...o)=>e.handtoggleAllSelection&&e.handtoggleAllSelection(...o))},"全选"),a("span",{class:"margin_right_10",onClick:t[1]||(t[1]=o=>e.toggleSelection())},"取消选项"),a("span",{onClick:t[2]||(t[2]=(...o)=>e.moveToCol&&e.moveToCol(...o))},"移入收藏夹"),a("span",ce,[S(" 共有 "),a("i",null,B(e.totleCount),1),S(" 件商品 ")]),a("span",de,[S(" 总计 "),a("i",null,B(e.totlePrice),1)]),a("span",{class:"go_pay",onClick:t[3]||(t[3]=(...o)=>e.buyBtn&&e.buyBtn(...o))},"去支付")]),i(V,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[5]||(t[5]=o=>e.dialogVisible=o),title:"确定移除",width:"30%"},{footer:u(()=>[a("span",ge,[i(y,{onClick:t[4]||(t[4]=o=>e.dialogVisible=!1)},{default:u(()=>[S("取消")]),_:1}),i(y,{type:"primary",onClick:e.shopBusDelete},{default:u(()=>[S("确定")]),_:1},8,["onClick"])])]),default:u(()=>[ue]),_:1},8,["modelValue"]),e.dialogTableVisible?(f(),O(p,{key:0,dialogTableVisible:e.dialogTableVisible,buyData:e.buyData,onMyrefresh:e.myrefresh,onShopClose:t[6]||(t[6]=o=>e.dialogTableVisible=!1)},null,8,["dialogTableVisible","buyData","onMyrefresh"])):E("",!0)],64)}const ye=q($,[["render",pe],["__scopeId","data-v-4a761463"]]);export{ye as default};
