import{o as c,g as u,f as a,t as d,h as j,i as E,r as T,k as S,j as O,d as p,e as D,w as _,l as z,m as v,p as g,F as y,x as k,q as A,H as F,s as R,v as L}from"./vendor.dc59bbfd.js";import{_ as U,e as q,a as H,d as G}from"./index.7834eb9a.js";import{g as J}from"./order.637f350b.js";const K={name:"Coupon",props:{coupon:{type:Object,default:()=>{}},isActive:{type:Boolean,default:!1},isDisabled:{type:Boolean,default:!1}},setup(i){return{}}},Q={class:"coupon_header"},W={class:"top"},X={class:"coupon_footer"};function Y(i,l,r,e,f,P){return c(),u("div",{class:j(["coupon_wrapper",r.isActive?"active":"",r.isDisabled?"disabled":""])},[a("div",Q,[a("div",W,[a("strong",null,"\uFFE5"+d(r.coupon.reduce),1),a("span",null," \u6EE1"+d(r.coupon.price),1),a("div",null,"\u6709\u6548\u671F\u81F3"+d(r.coupon.time||"2023-2-20"),1)])]),a("div",X,d(r.coupon.limit),1)],2)}var Z=U(K,[["render",Y]]);const $={name:"Shoping",components:{Coupon:Z},props:{buyData:{type:Object,default:()=>{}},dialogTableVisible:{type:Boolean,default:!1},propReceive:{type:Number,default:""}},emits:["shopClose","myrefresh"],setup(i,l){const r=Array.isArray(i.buyData)?i.buyData:[i.buyData],e=E(),f=T(),P=S(()=>i.dialogTableVisible),h=T("1"),C=e.getters.receivingAddress,b=q(e.getters.vip),w=C.map(n=>({value:n.addr_id,label:n.user+" "+H(n.receivingAddress)+" "+n.phoneNumber})),V=["\u5FAE\u4FE1","\u652F\u4ED8\u5B9D"],x=e.getters.consumerCoupon,B=S(()=>{let n=0;return r.forEach(t=>n+=Number(t.price)*t.count),n}),o=S(()=>{const n=s.consumerCoupon.reduce;let t=n||0,m=0;return r.forEach(M=>m+=Number(M.price)*M.count),m=m-s.campusBean/100-t,b&&(m=(m*.95).toFixed(2)),m}),s=O({receiveInfo:i.propReceive,payMethod:"\u5FAE\u4FE1",consumerCoupon:"",campusBean:0});return{dialogTableVisible:P,formData:s,receiveInfo:w,payMethods:V,dialogClose:()=>{l.emit("shopClose"),f.value=-1,s.campusBean=0,s.consumerCoupon=""},buyData:r,allPrice:o,consumerCoupons:x,activeName:h,store:e,goPay:()=>{if(!s.receiveInfo){A({message:"\u8BF7\u586B\u5199\u6536\u8D27\u4EBA\u4FE1\u606F",type:"warning",offset:60});return}const n=F.service({lock:!0,text:"\u8BA2\u5355\u751F\u6210\u4E2D",background:"rgba(0, 0, 0, 0.7)"});J({goods:r.map(t=>({jid:t.jid,count:t.count,des:t.des,price:t.price,img:t.img,category:t.category,isComment:!1})),generateTime:Date.now(),originalPrice:B.value,finalPrice:o.value,coupon:s.consumerCoupon,campusBean:s.campusBean,receiveInfo:s.receiveInfo,payMethod:s.payMethod,isPay:!0,isReceive:!1,is_vip:b}).then(()=>{setTimeout(()=>{n.close(),l.emit("shopClose"),A({message:"\u8D2D\u4E70\u6210\u529F\uFF0C\u67E5\u770B\u8BF7\u5230\u6211\u7684\u8BA2\u5355",type:"success",offset:60})},1e3),G(e),l.emit("myrefresh")},t=>{console.log(t)})},handleCoupons:(n,t)=>{if(t<=B.value)switch(f.value=n,t){case 10:s.consumerCoupon={reduce:2};break;case 99:s.consumerCoupon={reduce:10};break}},active_coupons:f,is_vip:b,campusBeanOptions:[{value:100},{value:200},{value:500},{value:1e3}]}}},I=i=>(R("data-v-45c09b92"),i=i(),L(),i),ee=I(()=>a("div",{class:"bold_text"},"\u6536\u8D27\u4EBA\u4FE1\u606F",-1)),oe={class:"shop_body_item"},ae=I(()=>a("div",{class:"bold_text"},"\u652F\u4ED8\u65B9\u5F0F",-1)),se={class:"shop_body_item"},le=I(()=>a("div",{class:"bold_text"},"\u9001\u8D27\u6E05\u5355",-1)),te={class:"shop_body_item"},ne=["src"],ce={class:"good_des"},ie={class:"good_price"},re={class:"good_count"},de={class:"shop_body_item"},ue={class:"consumer_coupons"},_e=["onClick"],pe={class:"campusBean"},me=I(()=>a("br",null,null,-1)),ve=k("\u672C\u6B21\u4F7F\u7528 "),fe={class:"footer_wrapper"},be={key:0,class:"plus"},ge={class:"allPrice"};function ye(i,l,r,e,f,P){const h=p("el-option"),C=p("el-select"),b=p("el-radio"),w=p("Coupon"),V=p("el-tab-pane"),x=p("el-tabs"),B=p("el-dialog");return c(),D(B,{modelValue:e.dialogTableVisible,"onUpdate:modelValue":l[5]||(l[5]=o=>e.dialogTableVisible=o),title:"\u7ED3\u7B97\u9875","custom-class":"dialog_wrapper","before-close":e.dialogClose,width:600,"destroy-on-close":!0},{footer:_(()=>[a("div",fe,[e.is_vip?(c(),u("span",be,"Plus\u4F1A\u5458\u72EC\u4EAB95\u6298")):z("",!0),a("span",ge,"\u603B\u8BA1:\uFFE5"+d(e.allPrice),1),a("span",{class:"payBtn",onClick:l[4]||(l[4]=(...o)=>e.goPay&&e.goPay(...o))},"\u53BB\u652F\u4ED8")])]),default:_(()=>[ee,a("div",oe,[v(C,{modelValue:e.formData.receiveInfo,"onUpdate:modelValue":l[0]||(l[0]=o=>e.formData.receiveInfo=o),placeholder:"Select",size:"large",style:{width:"300px"}},{default:_(()=>[(c(!0),u(y,null,g(e.receiveInfo,o=>(c(),D(h,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),ae,a("div",se,[(c(!0),u(y,null,g(e.payMethods,(o,s)=>(c(),D(b,{modelValue:e.formData.payMethod,"onUpdate:modelValue":l[1]||(l[1]=N=>e.formData.payMethod=N),key:s,label:o,size:"large",class:"pay_method"},{default:_(()=>[k(d(o),1)]),_:2},1032,["modelValue","label"]))),128))]),le,a("div",te,[(c(!0),u(y,null,g(e.buyData,(o,s)=>(c(),u("div",{class:"good_item",key:s},[a("img",{class:"good_img",src:o.img},null,8,ne),a("span",ce,d(o.des),1),a("i",ie,"\uFFE5"+d(o.price),1),a("span",re,"\xD7"+d(o.count),1)]))),128))]),a("div",de,[v(x,{modelValue:e.activeName,"onUpdate:modelValue":l[3]||(l[3]=o=>e.activeName=o),class:"demo-tabs"},{default:_(()=>[v(V,{label:"\u4F18\u60E0\u5238",name:"1"},{default:_(()=>[a("div",ue,[(c(!0),u(y,null,g(e.consumerCoupons,(o,s)=>(c(),u("div",{class:"consumer_coupon",key:s,onClick:N=>e.handleCoupons(s,o.price)},[v(w,{coupon:o,class:"coupon","is-active":e.active_coupons===s,"is-disabled":e.allPrice<=o.price},null,8,["coupon","is-active","is-disabled"])],8,_e))),128))])]),_:1}),v(V,{label:"\u6821\u56ED\u8C46",name:"2"},{default:_(()=>[a("div",pe,[k(" \u8D26\u6237\u5171 "+d(e.store.getters.campusBean)+" \u6821\u56ED\u8C46",1),me,ve,v(C,{modelValue:e.formData.campusBean,"onUpdate:modelValue":l[2]||(l[2]=o=>e.formData.campusBean=o),placeholder:"Select",size:"small"},{default:_(()=>[(c(!0),u(y,null,g(e.campusBeanOptions,o=>(c(),D(h,{key:o.value,label:o.value,value:o.value,disabled:o.value>=e.store.getters.campusBean},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"]),k(" \u62B5\u6263\uFFE5"+d(e.formData.campusBean/100),1)])]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["modelValue","before-close"])}var ke=U($,[["render",ye],["__scopeId","data-v-45c09b92"]]);export{ke as S};
