import{i as q,u as z,r as p,y as L,d as h,o as f,g as v,m as r,w as u,f as a,p as S,t as B,e as O,l as E,F as R,s as D,k as G,q as H,v as J,x as Q}from"./vendor.d3eff5ec.js";import{S as W}from"./Shoping.e66f45f2.js";import{a as X,g as Y}from"./userHome.85656dd8.js";import{_ as Z,d as I}from"./index.986d2493.js";import"./order.5842bc47.js";const $={name:"ShopBus",components:{Shoping:W},setup(m){const l=q(),j=z(),e=p();let C=p("0"),w=p("0.00"),c=p([]),b=p(!1),k=p(!1),y=p(""),V=[];const g=p([]),o=()=>{if(g.value.length<=0){D({message:"\u81F3\u5C11\u9009\u62E9\u4E00\u79CD\u5546\u54C1",type:"warning",offset:60});return}k.value=!0},_=t=>{V=t;let s=0,n=0,d=g.value.length;t.forEach(i=>{s+=i.count,n+=i.count*i.price}),C.value=s,w.value=n.toFixed(2),g.value.splice(0,d),t.forEach(i=>{g.value.push({jid:i.jid,img:i.goods.img,des:i.goods.des,price:i.price,count:G(()=>i.count),category:i.goods.category})})},T=t=>{e.value.toggleAllSelection()},A=t=>{t?t.forEach(s=>{e.value.toggleRowSelection(s,void 0)}):e.value.clearSelection()},N=t=>{let s=0,n=0;V.forEach(d=>{s+=d.count,n+=d.count*d.price}),C.value=s,w.value=n.toFixed(2)},U=()=>{D({message:"\u6536\u85CF\u6210\u529F",type:"success",offset:60})},F=t=>t.jid,M=()=>{X({Ptarget:"shopBus",target:"jid",val:[y.value]}).then(async t=>{D({message:"\u5220\u9664\u6210\u529F",type:"success",offset:60}),await I(l),x(l.getters.shopBus)},t=>{D({message:"\u5220\u9664\u5931\u8D25",type:"error",offset:60})}).finally(()=>{b.value=!1})},P=t=>{b.value=!0,y.value=t.jid},x=t=>{c.value=[];const s={ids:t.map(n=>n.jid)};Y(s).then(n=>{Array.isArray(n)&&n.length>0&&n.forEach((d,i)=>{c.value.push({goods:{img:d.imgUrl,des:d.detail,category:t[i].category},jid:d.id,price:d.price.split("\uFFE5")[1],count:1,operation:["delete"],curprice:0})})},n=>{console.log(n)})},K=t=>{var s;j.push({path:`/detail/${(s=t==null?void 0:t.goods)==null?void 0:s.category}/${t.jid}`})};return L(()=>{x(l.getters.shopBus)}),{multipleTableRef:e,handleSelectionChange:_,toggleSelection:A,handtoggleAllSelection:T,handleNumChange:N,moveToCol:U,tableData:c,totleCount:C,totlePrice:w,getRowKeys:F,shopBusDelete:M,dialogVisible:b,btnDelete:P,buyBtn:o,buyData:g,dialogTableVisible:k,myrefresh:async()=>{e.value.clearSelection(),await I(l),x(l.getters.shopBus)},goodClick:K}}},ee=m=>(J("data-v-33c32f06"),m=m(),Q(),m),oe=["onClick"],te=["src"],le={class:"count_wrapper"},ae={class:"operation_wrapper"},ne={class:"operation_wrapper"},se=["onClick"],ie={key:1},re={class:"bottom_bar"},ce={class:"totle_count"},de={class:"totle_price"},ue=ee(()=>a("span",null,"\u662F\u5426\u79FB\u9664\u6B64\u5546\u54C1",-1)),pe={class:"dialog-footer"};function ge(m,l,j,e,C,w){const c=h("el-table-column"),b=h("el-input-number"),k=h("el-table"),y=h("el-button"),V=h("el-dialog"),g=h("Shoping");return f(),v(R,null,[r(k,{ref:"multipleTableRef",data:e.tableData,"row-key":e.getRowKeys,onSelectAll:e.handleSelectionChange,onSelect:e.handleSelectionChange},{default:u(()=>[r(c,{type:"selection","reserve-selection":!0,"row-key":"jid",width:"55"}),r(c,{label:"\u5546\u54C1",width:"450"},{default:u(o=>[a("div",{class:"goods_wrapper",onClick:_=>e.goodClick(o.row)},[a("img",{src:o.row.goods.img,alt:""},null,8,te),a("div",null,B(o.row.goods.des),1)],8,oe)]),_:1}),r(c,{prop:"price",label:"\u5355\u4EF7(\u5143)",width:"120"}),r(c,{prop:"count",label:"\u6570\u91CF",width:"150"},{default:u(o=>[a("div",le,[r(b,{modelValue:o.row.count,"onUpdate:modelValue":_=>o.row.count=_,min:1,max:100,size:"small",onChange:e.handleNumChange},null,8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),r(c,{prop:"curprice",label:"\u5C0F\u8BA1(\u5143)",width:"120"},{default:u(o=>[a("div",ae,B((o.row.count*o.row.price).toFixed(2)),1)]),_:1}),r(c,{prop:"operation",label:"\u64CD\u4F5C"},{default:u(o=>[a("div",ne,[(f(!0),v(R,null,H(o.row.operation,(_,T)=>(f(),v("div",{key:T},[_=="delete"?(f(),v("div",{key:0,onClick:A=>e.btnDelete(o.row)}," \u5220\u9664 ",8,se)):_=="check"?(f(),v("div",ie,"\u67E5\u770B")):E("",!0)]))),128))])]),_:1})]),_:1},8,["data","row-key","onSelectAll","onSelect"]),a("div",re,[a("span",{class:"margin_right_10",onClick:l[0]||(l[0]=(...o)=>e.handtoggleAllSelection&&e.handtoggleAllSelection(...o))},"\u5168\u9009"),a("span",{class:"margin_right_10",onClick:l[1]||(l[1]=o=>e.toggleSelection())},"\u53D6\u6D88\u9009\u9879"),a("span",{onClick:l[2]||(l[2]=(...o)=>e.moveToCol&&e.moveToCol(...o))},"\u79FB\u5165\u6536\u85CF\u5939"),a("span",ce,[S(" \u5171\u6709 "),a("i",null,B(e.totleCount),1),S(" \u4EF6\u5546\u54C1 ")]),a("span",de,[S(" \u603B\u8BA1 "),a("i",null,B(e.totlePrice),1)]),a("span",{class:"go_pay",onClick:l[3]||(l[3]=(...o)=>e.buyBtn&&e.buyBtn(...o))},"\u53BB\u652F\u4ED8")]),r(V,{modelValue:e.dialogVisible,"onUpdate:modelValue":l[5]||(l[5]=o=>e.dialogVisible=o),title:"\u786E\u5B9A\u79FB\u9664",width:"30%"},{footer:u(()=>[a("span",pe,[r(y,{onClick:l[4]||(l[4]=o=>e.dialogVisible=!1)},{default:u(()=>[S("\u53D6\u6D88")]),_:1}),r(y,{type:"primary",onClick:e.shopBusDelete},{default:u(()=>[S("\u786E\u5B9A")]),_:1},8,["onClick"])])]),default:u(()=>[ue]),_:1},8,["modelValue"]),e.dialogTableVisible?(f(),O(g,{key:0,dialogTableVisible:e.dialogTableVisible,buyData:e.buyData,onMyrefresh:e.myrefresh,onShopClose:l[6]||(l[6]=o=>e.dialogTableVisible=!1)},null,8,["dialogTableVisible","buyData","onMyrefresh"])):E("",!0)],64)}var ve=Z($,[["render",ge],["__scopeId","data-v-33c32f06"]]);export{ve as default};
